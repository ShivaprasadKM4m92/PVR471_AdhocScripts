//# sourceMappingURL=actionItemModal.js.map
$(document).ready(function(){$(".select2-box").select2()});var actionItem=actionItem||{};
actionItem.actionItemModal=function(){var k,g,l=function(b,a,d,c){c=a.find("#actionItemForm").serialize();void 0!=a.find("#actionCategory").attr("disabled")&&(c=c+"&actionCategory="+a.find("#actionCategory").select2("val"));var f=a.find("#assignedToName").val();if(!f)var g=a.find("#assignedTo").select2("data"),f=g?g.text:"";$.ajax({url:saveActionItemUrl,type:"post",data:c,error:function(c){a.find(".save-action-item").attr("disabled",!1);$("#actionItemModal .alert-danger").removeClass("hide");c=c.responseJSON.message;
for(var b=0;b<c.length;b++)$("#"+c[b]).attr("style","border-color:#a94442");$(".alert-danger").show()},success:function(c){a.modal("hide");h(a);b?($(".alert-success").removeClass("hide"),"undefined"!=typeof d&&d==PR_Calendar?$("#calendar").fullCalendar("refetchEvents"):actionItem.actionItemList.reload_action_item_table(),$("#successNotification").html($.i18n._("actionItem.create.success",f)),$(".alert-danger").addClass("hide")):("undefined"==typeof d||d!=PERIODIC_REPORT&&d!=ADHOC_REPORT&&d!=QUALITY_MODULE||
location.reload(),"undefined"!=typeof d&&d==QUALITY_MODULE_CAPA&&reloadCapaActionList())}})},m=function(b){b.modal("hide");h(b);$(".alert-danger").hide();k&&$("#actionItemForm").find(".form-control").attr("style","background-color: #fff;background-image: none;border: 1px solid #ccc")},h=function(b){b.find("#actionItemForm")[0].reset();b.find("#actionCategory").trigger("change");b.find("#actionCategory").select2("val","");b.find("#assignedTo").select2("val","");b.find("#priority").select2("val","");
clearFormInputsChangeFlag(b.find("#actionItemForm")[0]);$("#fieldErrorMessage").show();$("#otherErrorMessage").hide();$(".update-action-item").prop("disabled",!1);$(".alert-danger").hide()},n=function(b,a){b.find(".form-control").attr("disabled",a);b.find(".actionItemRadios ").attr("disabled",a)},t=function(b,a){b.find("#aiVersion").val(a.version);b.find("#description").val(a.description);b.find("#actionCategory").select2("val",a.actionCategory);b.find("#priority").select2("val",a.priority);b.find("#status").select2("val",
a.status);b.find("#assignedTo").select2("val",a.assignedToId);b.find("#createdBy").html(a.createdBy);b.find("#completionDate").val(a.completionDate?moment(a.completionDate).format(DEFAULT_DATE_DISPLAY_FORMAT):"");b.find("#dueDate").val(a.dueDate?moment(a.dueDate).format(DEFAULT_DATE_DISPLAY_FORMAT):"");b.find("#dateCreated").html(a.dateCreated);b.find("#associatedCaseNumber").html(a.associatedCaseNumber);a.associatedCaseNumber&&""!=a.associatedCaseNumber?b.find("#associatedCaseNoDiv").show():b.find("#associatedCaseNoDiv").hide();
a.executedReportConfigurationId?(b.find("#link").attr("href",b.find("#link").attr("data-base-url")+"/"+a.executedReportConfigurationId),b.find("#link").html(a.executedReportConfigurationName),b.find("#link").css("word-wrap","break-word"),b.find("#linkDiv").show()):b.find("#linkDiv").hide();a.configurationId?(b.find("#configLink").attr("href",b.find("#configLink").attr("data-base-url")+"/"+a.configurationId),b.find("#configLink").html(a.configurationName),b.find("#configLink").css("word-wrap","break-word"),
b.find("#linkConfigDiv").show()):b.find("#linkConfigDiv").hide();a.reportRequestId?(b.find("#requestLink").attr("href",b.find("#requestLink").attr("data-base-url")+"/"+a.reportRequestId),b.find("#requestLink").html(a.reportRequestName),b.find("#requestLink").css("word-wrap","break-word"),b.find("#linkRequestDiv").show()):b.find("#linkRequestDiv").hide()},u=function(b,a){$.ajax({url:viewActionItemUrl,data:"actionItemId="+b,error:function(a){console.log(a)},success:function(b){b.dateCreated=b.dateCreated?
moment.utc(b.dateCreated).tz(userTimeZone).format(DATEPICKER_FORMAT_AM_PM):"";t(a,b)}})},q=function(b,a,d,c,f){c=a.find("#actionItemForm").serialize();var g=(f=a.find("#assignedTo").select2("data"))?f.text:"";void 0!=a.find("#actionCategory").attr("disabled")&&(c=c+"&actionCategory="+a.find("#actionCategory").select2("val"));$.ajax({url:updateActionItemUrl,type:"post",data:c,error:function(b){$("#actionItemModal .alert-danger").removeClass("hide");a.find(".save-action-item").attr("disabled",!1);if(400===
b.status){var c=b.responseJSON.message;for(b=0;b<c.length;b++)$("#"+c[b]).attr("style","border-color:#a94442");$(".alert-danger").show();setTimeout(function(){for(var a=0;a<c.length;a++)$("#"+c[a]).attr("style","none")},2E3)}else $("#fieldErrorMessage").hide(),$("#otherErrorMessage").html(b.responseJSON.message),$("#otherErrorMessage").show(),$(".alert-danger").show(),$(".update-action-item").prop("disabled",!0)},success:function(c){a.modal("hide");actionItem.actionItemModal.clear_action_item_modal(a);
b?("undefined"!=typeof d&&d==PR_Calendar?$("#calendar").fullCalendar("refetchEvents"):actionItem.actionItemList.reload_action_item_table(),$(".alert-success").removeClass("hide"),$("#successNotification").html($.i18n._("actionItem.update.success",g)),$(".alert-danger").addClass("hide")):"undefined"!=typeof d&&d==QUALITY_MODULE_CAPA?reloadCapaActionList():"undefined"!=typeof d&&("undefined"==typeof d||d==REPOERT_REQUEST&&d==ADHOC_REPORT)&&d!=QUALITY_MODULE||location.reload()}})};return{init_action_item_modal:function(b,
a,d){k=b;var c=$("#actionItemModal");c.modal("show");c.find(".consultationButtons").addClass("hide");c.find(".creationButton").removeClass("hide");n(c,!1);h(c);b=moment(new Date).tz(userTimeZone).format(DATEPICKER_FORMAT_AM_PM);c.find(".dateCreated").html(b);c.find("input[name=dateCreated]").val(b);initializePastDatesNotAllowedDatePicker();"undefined"!=typeof a&&a==PR_Calendar?c.find("#dueDate").val($("#dueDateHidden").val()):c.find("#dueDate").val("");c.find("#completionDate").val("");c.find("#creationScreenButton").attr("disabled",
!1);c.find("#assignedToName").val("");c.find("#assignedTo").on("change",function(){var a=$(this).find("option:selected").text();c.find("#assignedToName").select2("val",a)});"undefined"!=typeof a&&a==REPOERT_REQUEST&&c.find("#actionCategory").select2("val",ACTION_ITEM_CATEGORY_ENUM.REPORT_REQUEST);var f="",r="",e="",p="";c.find("#associatedCaseNoDiv").hide();"undefined"!=typeof a&&a==QUALITY_MODULE&&((b=$(d).attr("data-actionType"))?(c.find("#actionCategory").select2("val",ACTION_ITEM_CATEGORY_ENUM[b]),
c.find("#actionCategory").attr("disabled",!0)):c.find("#actionCategory").select2("val",ACTION_ITEM_CATEGORY_ENUM.QUALITY_MODULE),f=$(d).attr("data-caseNumber"),r=$(d).attr("data-caseVersion"),e=$(d).attr("data-errorType"),p=$("#dataType").val(),c.find("#actionCategory").attr("disabled",!0));"undefined"!=typeof a&&a==QUALITY_MODULE_CAPA&&(b=$(d).attr("data-actionType"),c.find("#actionCategory").select2("val",ACTION_ITEM_CATEGORY_ENUM[b]),c.find("#actionCategory").attr("disabled",!0));"undefined"!=
typeof a&&a==PERIODIC_REPORT&&c.find("#actionCategory").select2("val",ACTION_ITEM_CATEGORY_ENUM.PERIODIC_REPORT);"undefined"!=typeof a&&a==ADHOC_REPORT&&c.find("#actionCategory").select2("val",ACTION_ITEM_CATEGORY_ENUM.ADHOC_REPORT);c.find(".save-action-item").unbind().click(function(){k?l(k,c,a):"undefined"!=typeof a&&a==REPOERT_REQUEST?validateContent()?(reportRequest.reportRequestActionItems.add_action_item_to_request(c),c.modal("hide"),$("#actionItemModal").data("modal",null),h(c),$("#actionItemModal").find(".alert-danger").css("display",
"none")):$("#actionItemModal").find(".alert-danger").css("display","block"):"undefined"!=typeof a&&a==QUALITY_MODULE?(c.find(".save-action-item").attr("disabled",!0),$("#actionItemForm").find("#caseNumber").val(f),$("#actionItemForm").find("#caseVersion").val(r),$("#actionItemForm").find("#errorType").val(e),$("#actionItemForm").find("#dataTypeAi").val(p),$("#actionItemForm").find("#appType").val(a),c.find("#actionCategory").attr("disabled",!1),l(null,c,a,d)):"undefined"!=typeof a&&a==QUALITY_MODULE_CAPA?
(c.find(".save-action-item").attr("disabled",!0),$("#actionItemForm").find("#appType").val(a),$("#actionItemForm").find("#capaId").val(capaId),l(null,c,a,d)):"undefined"!=typeof a&&($("#actionItemForm").find("#executedReportId").val(g),$("#actionItemForm").find("#appType").val(a),l(null,c,a))});c.find(".close-action-item-model").click(function(){m(c)})},clear_action_item_modal:h,bind_close_model_event:m,toggle_element_disable:n,delete_action_item:function(b,a,d){var c=$("#deleteModal");c.modal("show");
$("#deleteDlgErrorDiv").hide();c.find("#deleteModalLabel").text($.i18n._("modal.delete.title",$.i18n._("app.label.action.app.name")));c.find("#nameToDelete").text($.i18n._("deleteThis",$.i18n._("app.label.action.app.name")));$("#deleteButton").off();$("#deleteButton").on("click",function(){$("#deleteJustification").val().trim()?($("#deleteDlgErrorDiv").hide(),$.ajax({url:deleteActionItemUrl,data:"actionItemId="+b+"&deleteJustification="+$("#deleteJustification").val(),error:function(b){console.log(b);
a&&($(".alert-success").addClass("hide"),$("#errorNotification").html($.i18n._("app.label.action.app.delete.fail")),$(".alert-danger").addClass("hide"))},success:function(b){a?("undefined"!=typeof d&&d==PR_Calendar?($("div[id^=calendar]").fullCalendar("refetchEvents"),$("#actionItemModal").modal("hide")):actionItem.actionItemList.reload_action_item_table(),$(".alert-success").removeClass("hide"),$("#successNotification").html($.i18n._("app.label.action.app.delete.success")),$(".alert-danger").addClass("hide")):
"undefined"!=typeof d&&d==QUALITY_MODULE_CAPA&&reloadCapaActionList()}}),c.modal("hide"),$("#deleteJustification").val("")):$("#deleteDlgErrorDiv").show()})},view_action_item:function(b){var a=$("#actionItemModal");a.modal("show");a.find("#creationScreenButton").addClass("hide");a.find("#editScreenButton").addClass("hide");a.find("#viewScreenButton").removeClass("hide");u(b,a);n(a,!0);a.find("#actionItemId").val(b);a.find(".close-action-item-model").click(function(){m(a)});a.find("#dueDateDiv").datepicker({allowPastDates:!1,
momentConfig:{format:DEFAULT_DATE_DISPLAY_FORMAT}});a.find("#completionDateDiv").datepicker({allowPastDates:!0,momentConfig:{format:DEFAULT_DATE_DISPLAY_FORMAT}});a.find("#dueDate").siblings("div.input-group-btn").find(".btn.btn-default.dropdown-toggle").attr("disabled","disabled");a.find("#completionDate").siblings("div.input-group-btn").find(".btn.btn-default.dropdown-toggle").attr("disabled","disabled")},edit_action_item:function(b,a,d,c,f,g){var e=$("#actionItemModal");e.modal("show");$("#actionItemModal").find(".alert-danger").css("display",
"none");$("#actionItemListModal").modal("hide");e.find("#creationScreenButton").addClass("hide");e.find("#editScreenButton").removeClass("hide");e.find("#viewScreenButton").addClass("hide");e.find("#deleteActionItem").addClass("hide");e.find("#dueDate").siblings("div.input-group-btn").find(".btn.btn-default.dropdown-toggle").removeAttr("disabled");e.find("#completionDate").siblings("div.input-group-btn").find(".btn.btn-default.dropdown-toggle").removeAttr("disabled");initializePastDatesNotAllowedDatePicker();
e.find("#dueDateDiv").datepicker({allowPastDates:!1,momentConfig:{format:DEFAULT_DATE_DISPLAY_FORMAT}});e.find("#completionDateDiv").datepicker({allowPastDates:!0,momentConfig:{format:DEFAULT_DATE_DISPLAY_FORMAT}});if(d||a)u(a,e);else if("undefined"!=typeof c&&c==REPOERT_REQUEST){var p={description:document.getElementById("actionItems["+f+"].description").value,actionCategory:document.getElementById("actionItems["+f+"].actionCategory").value,priority:document.getElementById("actionItems["+f+"].priority").value,
status:document.getElementById("actionItems["+f+"].status").value,assignedToId:document.getElementById("actionItems["+f+"].assignedTo").value,createdBy:$("#loggedInUser").html(),completionDate:document.getElementById("actionItems["+f+"].completionDate").value,dateCreated:$("#currentDate").val(),dueDate:document.getElementById("actionItems["+f+"].dueDate").value};t(e,p)}n(e,!1);e.find("#actionItemId").val(a);e.find("#index").val(f);e.find(".close-action-item-model").click(function(){m(e)});d||("undefined"!=
typeof c&&c==REPOERT_REQUEST?(e.find("#actionCategory").select2("val",ACTION_ITEM_CATEGORY_ENUM.REPORT_REQUEST),e.find(".update-action-item").click(function(){if(e.find("#actionItemId").val())q(d,e,c,void 0,f);else if(validateContent()){var a=e.find("#index").val();reportRequest.reportRequestActionItems.modifyAddedActionItem(a,e);e.modal("hide");$("#actionItemModal").data("modal",null);h(e);$("#actionItemModal").find(".alert-danger").css("display","none")}else $("#actionItemModal").find(".alert-danger").css("display",
"block")})):"undefined"==typeof c||c!=PERIODIC_REPORT&&c!=ADHOC_REPORT?"undefined"==typeof c||c!=QUALITY_MODULE&&c!=QUALITY_MODULE_CAPA||(e.find("#actionCategory").attr("disabled",!0),e.find(".update-action-item").click("click",function(){q(d,e,c,g)})):(e.find("#actionCategory").attr("disabled",!0),e.find(".update-action-item").click(function(){q(d,e,c)})));b?$("#actionItemModal .needsActionItemRole").prop("disabled",!1):$("#actionItemModal .needsActionItemRole").prop("disabled",!0)},update_action_item:q,
set_executed_report_id:function(b){g=b},view_action_item_list:function(b,a,d,c){var f=$("#actionItemListModal"),h=function(a){a.start=0;0<a.order.length&&(a.direction=a.order[0].dir,a.sort=a.columns[a.order[0].column].data);void 0===c?a.executedReportId=g:(a.caseNumber=c.caseNumber,a.errorType=c.errorType,a.dataType=c.dataType);a.filterType="Executed Report Related Action Items"};f.one("show.bs.modal",function(c){$.fn.DataTable.isDataTable("#actionItemList")&&$("#actionItemList").DataTable().destroy();
$("#actionItemList").DataTable({language:{url:"../assets/i18n/dataTables_"+userLocale+".json"},customProcessing:!0,serverSide:!0,searching:!1,paging:!1,info:!1,ajax:{url:listActionItemUrl,data:h},order:[[1,"asc"],[2,"desc"]],columns:[{mData:"assignedTo",bSortable:!1},{data:"description",render:function(c,e,f){c=30<f.description.length?f.description.substring(0,29)+"...":f.description;return'<a href="javascript:actionItem.actionItemModal.edit_action_item('+b+","+f.actionItemId+", "+a+", '"+d+"', null);\">"+
encodeToHTML(c)+"</a>"}},{data:"dueDate",className:"dataTableColumnCenter",render:function(a,b,c){return a?moment(a).format(DEFAULT_DATE_DISPLAY_FORMAT):""}},{data:"priority",render:function(a,b,c){b=document.createElement("span");b.classList.add("label");switch(a){case "HIGH":b.classList.add("label-danger");break;case "MEDIUM":b.classList.add("label-warning");break;default:b.classList.add("label-default")}b.appendChild(document.createTextNode(a));return b.outerHTML}},{mData:"status",aTargets:["status"],
mRender:function(a,b,c){return a?$.i18n._("status_enum."+a):""}}]});f.find(".close-action-item-model").click(function(){f.modal("hide")})});f.modal("show")}}}();function validateContent(){var k=!1,g=$("#actionItemModal"),l=g.find("#dueDate").val(),m=g.find("#assignedTo").val(),h=g.find("#completionDate").val(),n=g.find("#status").val(),g=g.find("#description").val();l&&m&&g&&(k=!("CLOSED"==n&&!h));return k};