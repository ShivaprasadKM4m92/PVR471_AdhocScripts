//# sourceMappingURL=emailTemplateEditor.js.map
$(document).ready(function(){function a(a){$.ajax({url:listTemplateUrl+(a?"?user=true":""),type:"get",error:function(a){alert((a.responseJSON.message?a.responseJSON.message:"")+(a.responseJSON.stackTrace?"\n"+a.responseJSON.stackTrace:""))},success:function(a){templateContent=a.data;a="";for(var b=0;b<templateContent.length;b++)a+='<div><a href="javascript:setTemplateContent('+templateContent[b].id+')">'+templateContent[b].name+'</a></div>\n                <div class="small">'+templateContent[b].description+
"</div>\n                  <br>";$("#templateListContent").html(a);$("#emailTemplateList").modal("show")}})}0<$("textarea[name=body]").length?tinymce.init({selector:"textarea[name=body]",height:500,branding:!1,plugins:"table image imagetools link code",imagetools_toolbar:"rotateleft rotateright | flipv fliph | editimage ",menubar:"edit insert format table tools",forced_root_block:"div"}):tinymce.init({selector:".richEditor",height:300,branding:!1,plugins:"table image imagetools link code",menu:{edit:{title:$.i18n._("email.editor.button.edit"),
items:"undo redo | cut copy paste pastetext | selectall"},insert:{title:$.i18n._("email.editor.button.insert"),items:"image link media | template hr"},view:{title:$.i18n._("email.editor.button.view"),items:"visualaid"},format:{title:$.i18n._("email.editor.button.format"),items:"bold italic underline strikethrough superscript subscript | formats | removeformat"},table:{title:$.i18n._("email.editor.button.table"),items:"inserttable tableprops deletetable | cell row column"},tools:{title:$.i18n._("email.editor.button.tools"),
items:"spellchecker code"},templatemenu:{title:$.i18n._("email.editor.button.templates"),items:"common users | updatetemplate savetemplate deletetemplate"}},imagetools_toolbar:"rotateleft rotateright | flipv fliph | editimage ",menubar:"templatemenu edit insert format table tools",content_css:EDITOR_CSS,forced_root_block:"div",setup:function(b){b.addMenuItem("common",{text:$.i18n._("email.editor.button.templates.load"),context:"templatemenu",onclick:function(){a(!1)}});b.addMenuItem("users",{text:$.i18n._("email.editor.button.templates.loadmy"),
context:"templatemenu",onclick:function(){a(!0)}});b.addMenuItem("updatetemplate",{text:$.i18n._("email.editor.button.templates.update"),context:"templatemenu",onclick:function(){isBodyNotEmpty()&&updateTemplate()},onpostrender:function(){updateTemplateButton=this;updateTemplateButton.disabled(!0)}});b.addMenuItem("savetemplate",{text:$.i18n._("email.editor.button.templates.save"),context:"templatemenu",onclick:function(){isBodyNotEmpty()&&$("#emailTemplateSave").modal("show")}});b.addMenuItem("deletetemplate",
{text:$.i18n._("email.editor.button.templates.delete"),context:"templatemenu",onclick:function(){removeTemplate()},onpostrender:function(){deleteTemplateButton=this;deleteTemplateButton.disabled(!0)}})}});$(document).on("click","#saveEmailTemplate",function(){var a=$("#emailTemplateName"),c=$("#emailTemplateDescription");""===a.val()?(a.css("border-color","red"),setTimeout(function(){a.css("border-color","#cccccc")},1E3)):""===c.val()?(c.css("border-color","red"),setTimeout(function(){c.css("border-color",
"#cccccc")},1E3)):$.ajax({url:saveTemplateUrl,type:"post",data:{body:tinyMCE.activeEditor.getContent(),name:a.val(),description:c.val()},error:function(a){alert((a.responseJSON.message?a.responseJSON.message:"")+(a.responseJSON.stackTrace?"\n"+a.responseJSON.stackTrace:""))},success:function(a){currentTemplate=a.data;updateTemplateButton.disabled(!1);deleteTemplateButton.disabled(!1);$("#emailTemplateSave").modal("hide")}})})});var updateTemplateButton,deleteTemplateButton,templateContent,currentTemplate;
function setTemplateContent(a){for(var b=0;b<templateContent.length;b++)if(templateContent[b].id===a){tinyMCE.activeEditor.setContent(templateContent[b].body);"USER"===templateContent[b].type.name?(currentTemplate=a,updateTemplateButton.disabled(!1),deleteTemplateButton.disabled(!1)):(currentTemplate=null,updateTemplateButton.disabled(!0),deleteTemplateButton.disabled(!0));break}$("#emailTemplateList").modal("hide")}
function isBodyNotEmpty(){if(tinyMCE.activeEditor.getContent()&&0<tinyMCE.activeEditor.getContent().length)return!0;var a=$("#confirmationModal");a.modal("show");a.find(".modalHeader").html($.i18n._("email.editor.confirm.error"));a.find(".confirmationMessage").html($.i18n._("email.editor.confirm.error.message"));a.find(".okButton").html($.i18n._("ok"));a.find(".okButton").unbind().click(function(){$("#confirmationModal").modal("hide")});return!1}
function removeTemplate(){var a=$("#confirmationModal");a.modal("show");a.find(".modalHeader").html($.i18n._("delete.confirm"));a.find(".okButton").html($.i18n._("yes"));a.find(".confirmationMessage").html($.i18n._("email.editor.confirm.delete"));a.find(".okButton").unbind().click(function(){$.ajax({url:deleteTemplateUrl,type:"get",data:{id:currentTemplate},error:function(a){alert((a.responseJSON.message?a.responseJSON.message:"")+(a.responseJSON.stackTrace?"\n"+a.responseJSON.stackTrace:""))},success:function(a){tinyMCE.activeEditor.setContent("");
updateTemplateButton.disabled(!0);deleteTemplateButton.disabled(!0)}})})}
function updateTemplate(){$.ajax({url:saveTemplateUrl,type:"post",data:{id:currentTemplate,body:tinyMCE.activeEditor.getContent()},error:function(a){alert((a.responseJSON.message?a.responseJSON.message:"")+(a.responseJSON.stackTrace?"\n"+a.responseJSON.stackTrace:""))},success:function(a){a=$("#confirmationModal");a.modal("show");a.find(".modalHeader").html($.i18n._("email.editor.confirm.success"));a.find(".confirmationMessage").html($.i18n._("email.editor.confirm.update.success"));a.find(".okButton").html($.i18n._("ok"));
a.find(".okButton").unbind().click(function(){$("#confirmationModal").modal("hide")})}})};