//# sourceMappingURL=templateQueries.js.map
var e2BDistributionChannel="E2B",rowIndex=0;
$(document).ready(function(){var c=$("#templateQueryList").attr("data-counter"),g,h=$("#templateQueryList"),e=function(d){return'<span title="'+d.text+'">'+d.text+"</span>"},n=function(){m(!1)},t=function(){m(!0)},m=function(d){var b=$("#templateQuery_clone").clone(),a="templateQueries["+c+"].",k=b.find("input[id$=template]"),S=b.find("i[id$=deleteButton]"),f=b.find("input[id$=query]"),g=b.find("select[id$=operator]"),h=b.find("select[id$=queryLevel]"),u=b.find("select[id$=dateRangeInformationForTemplateQuery\\.dateRangeEnum]"),
m=b.find("div[id$=datePickerFromDiv]"),n=b.find("div[id$=datePickerToDiv]"),l=b.find("input[id$=dateRangeInformationForTemplateQuery\\.dateRangeStartAbsolute]"),C=b.find("input[id$=dateRangeInformationForTemplateQuery\\.dateRangeEndAbsolute]"),D=b.find("input[id$=dateRangeInformationForTemplateQuery\\.relativeDateRangeValue]"),E=b.find("input[id$=header]"),p=b.find("textarea[id$=footer]"),F=b.find("input[id$=title]"),G=b.find("input[id$=headerProductSelection]"),H=b.find("input[id$=headerDateRange]"),
I=b.find("input[id$=draftOnly]"),J=b.find("input[id$=blindProtected]"),K=b.find("input[id$=privacyProtected]"),L=b.find("input[id$=displayMedDraVersionNumber]"),v=b.find("select[id$=authorizationType]"),M=b.find("input[id$=dueInDays]"),w=b.find("select[id$=msgType]"),q=b.find("select[id$=distributionChannelName]"),x=b.find("input[id$=emailConfiguration\\.subject]"),y=b.find("input[id$=emailConfiguration\\.to]"),z=b.find("input[id$=emailConfiguration\\.cc]"),A=b.find("input[id$=emailConfiguration\\.body]"),
B=b.find("input[id$=emailConfiguration\\.deliveryReceipt]"),t=b.find("span[id=showEmailConfiguration-_clone]");b.find("input[id$=version]").attr("id",a+"version").attr("name",a+"version");b.find("input[id$=id]").attr("id",a+"id").attr("name",a+"id");b.find("input[id$=dynamicFormEntryDeleted]").attr("id",a+"dynamicFormEntryDeleted").attr("name",a+"dynamicFormEntryDeleted");b.find("input[id$=new]").attr("id",a+"new").attr("name",a+"new").attr("value","true");b.find(".validQueries").attr("id",a+"validQueries").attr("name",
a+"validQueries");k.attr("id",a+"template").attr("name",a+"template");f.attr("id",a+"query").attr("name",a+"query");g.attr("id",a+"operator").attr("name",a+"operator");h.attr("id",a+"queryLevel").attr("name",a+"queryLevel");S.attr("id",a+"deleteButton").attr("name",a+"deleteButton").attr("data-id",c);D.attr("id",a+"dateRangeInformationForTemplateQuery.relativeDateRangeValue").attr("name",a+"dateRangeInformationForTemplateQuery.relativeDateRangeValue");u.attr("id",a+"dateRangeInformationForTemplateQuery.dateRangeEnum").attr("name",
a+"dateRangeInformationForTemplateQuery.dateRangeEnum");m.attr("id",a+"datePickerFromDiv");n.attr("id",a+"datePickerToDiv");l.attr("id",a+"dateRangeInformationForTemplateQuery.dateRangeStartAbsolute").attr("name",a+"dateRangeInformationForTemplateQuery.dateRangeStartAbsolute");C.attr("id",a+"dateRangeInformationForTemplateQuery.dateRangeEndAbsolute").attr("name",a+"dateRangeInformationForTemplateQuery.dateRangeEndAbsolute");E.attr("id",a+"header").attr("name",a+"header");p.attr("id",a+"footer").attr("name",
a+"footer");p.autocomplete({source:p.data("select")});F.attr("id",a+"title").attr("name",a+"title");G.attr("id",a+"headerProductSelection").attr("name",a+"headerProductSelection");H.attr("id",a+"headerDateRange").attr("name",a+"headerDateRange");I.attr("id",a+"draftOnly").attr("name",a+"draftOnly");J.attr("id",a+"blindProtected").attr("name",a+"blindProtected");K.attr("id",a+"privacyProtected").attr("name",a+"privacyProtected");L.attr("id",a+"displayMedDraVersionNumber").attr("name",a+"displayMedDraVersionNumber");
v.attr("id",a+"authorizationType").attr("name",a+"authorizationType");M.attr("id",a+"dueInDays").attr("name",a+"dueInDays");w.attr("id",a+"msgType").attr("name",a+"msgType");q.attr("id",a+"distributionChannelName").attr("name",a+"distributionChannelName").attr("onchange","distributionChannelChanged("+c+")");x.attr("id",a+"emailConfiguration.subject").attr("name",a+"emailConfiguration.subject");y.attr("id",a+"emailConfiguration.to").attr("name",a+"emailConfiguration.to");z.attr("id",a+"emailConfiguration.cc").attr("name",
a+"emailConfiguration.cc");A.attr("id",a+"emailConfiguration.body").attr("name",a+"emailConfiguration.body");B.attr("id",a+"emailConfiguration.deliveryReceipt").attr("name",a+"emailConfiguration.deliveryReceipt");t.attr("id","showEmailConfiguration-"+c).attr("onclick","showEmailConfiguration("+c+")");b.attr("id","templateQuery"+c);bindTemplateSelect2(k).on("change",function(a){selectTemplateOnChange(this,cioms1Id);updateAttachmentTable()});bindQuerySelect2(f).on("change",function(a){selectQueryOnChange(this)});
g.select2({formatSelection:e});h.select2({formatSelection:e});u.select2({formatSelection:e}).on("change",function(a){daraRangeEnumClassOnChange(this)});v.select2({formatSelection:e});w.select2({formatSelection:e});q.select2({formatSelection:e});$("#templateQueryList").append(b);if(d){for(var r=0,a=0;a<c;a++)"false"==$("#templateQueries\\["+a+"\\]\\.dynamicFormEntryDeleted").val()&&(r=a);var N=c,a=getQueryWrapperRow(f),O=getExpressionValues(a);$(O).on("loadBlankAndCustomSqlFieldsComplete",function(){P(r,
N)});var a=getTemplateContainer(k),Q=getTemplateValues(a);$(Q).on("loadCustomSQLValuesForTemplateComplete",function(){P(r,N)});a="templateQueries\\["+r+"\\]\\.";k.val($("#"+a+"template").val()).trigger("change");k.one("change",function(){$(Q).off("loadCustomSQLValuesForTemplateComplete")});f.val($("#"+a+"query").val()).trigger("change");f.one("change",function(){$(O).off("loadBlankAndCustomSqlFieldsComplete")});g.val($("#"+a+"operator").val()).trigger("change");h.val($("#"+a+"queryLevel").val()).trigger("change");
u.val($("#"+a+"dateRangeInformationForTemplateQuery\\.dateRangeEnum").val()).trigger("change");l.val($("#"+a+"dateRangeInformationForTemplateQuery\\.dateRangeStartAbsolute").val());C.val($("#"+a+"dateRangeInformationForTemplateQuery\\.dateRangeEndAbsolute").val());D.val($("#"+a+"dateRangeInformationForTemplateQuery\\.relativeDateRangeValue").val());E.val($("#"+a+"header").val());p.val($("#"+a+"footer").val());F.val($("#"+a+"title").val());G.prop("checked",$("#"+a+"headerProductSelection").prop("checked"));
H.prop("checked",$("#"+a+"headerDateRange").prop("checked"));I.prop("checked",$("#"+a+"draftOnly").prop("checked"));J.prop("checked",$("#"+a+"blindProtected").prop("checked"));K.prop("checked",$("#"+a+"privacyProtected").prop("checked"));L.prop("checked",$("#"+a+"displayMedDraVersionNumber").prop("checked"));v.val($("#"+a+"authorizationType").val()).trigger("change");M.val($("#"+a+"dueInDays").val());w.val($("#"+a+"msgType").val()).trigger("change");q.val($("#"+a+"distributionChannelName").val()).trigger("change");
x.val($("#"+a+"emailConfiguration\\.subject").val());y.val($("#"+a+"emailConfiguration\\.to").val());z.val($("#"+a+"emailConfiguration\\.cc").val());A.val($("#"+a+"emailConfiguration\\.body").val());B.val($("#"+a+"emailConfiguration\\.deliveryReceipt").val());""!=x.val()||""!=A.val()||""!=y.val()||""!=z.val()||""!=B.val()?$("#showEmailConfiguration-"+c+" img").attr({src:"/reports/assets/icons/email-secure.png",title:$.i18n._("app.configuration.addEmailConfigurationEdited.label")}):$("#showEmailConfiguration-"+
c+" img").attr({src:"/reports/assets/icons/email.png",title:$.i18n._("app.configuration.addEmailConfiguration.label")})}b.show();if(0!=c)b.find(".showHeaderFooterArea").on("click",R);c++;1<$(".templateQuery-div:visible").length&&$.each($(".templateQuery-div:visible"),function(){$($(this).find(".templateQueryDeleteButton")).show()});d&&updateAttachmentTable();q.val()==e2BDistributionChannel?$(".e2BConfiguration").show():$(".e2BConfiguration").hide()},P=function(d,b){d=$("[name^='templateQuery"+d+".'][name$='].value'],[name^='templateQuery"+
d+".'][name$='].copyPasteValue']");_.each(d,function(a){a=$(a);var d="templateQuery"+b+a.attr("name").substring(a.attr("name").indexOf("."));if(a.val()){var c=$("[name='"+d+"']");if(a.hasClass("expressionValueSelectAuto")){var f=[];_.each(a.val().split(";"),function(a){f.push({id:a,text:a});c.select2("data",f)})}else a.hasClass("expressionValueSelectNonCache")?(f=[],_.each(a.val().split(";"),function(a){f.push({id:a,text:a});c.select2("data",f)})):c.val(a.val()).trigger("change");a.hasClass("expressionValueText")&&
(c=$("[name='"+d.replace("value","copyPasteValue")+"']"),d=c.closest(".toAddContainerQEV")[0])&&(c.val(a.val()),$(d).find(".isFromCopyPaste").val("true"),showHideValue(EDITOR_TYPE_TEXT,d))}})},l=function(d){d=$(d).find("i.templateQueryDeleteButton");$(d).hide()},R=function(){var d=$(this),d=$(d).parent().parent().parent().find(".headerFooterArea");d.toggle();d.is(":visible")?$(this).text(LABELS.labelHideAdavncedOptions):$(this).text(LABELS.labelShowAdavncedOptions)};(function(){if(0==c)n();else{bindTemplateSelect2($("#templateQueryList").find(".selectTemplate")).on("change",
function(b){selectTemplateOnChange(this,cioms1Id);updateAttachmentTable()}).on("initCompete",function(){updateAttachmentTable()});bindQuerySelect2($("#templateQueryList").find(".selectQuery")).on("change",function(b){selectQueryOnChange(this)});var d=$("#templateQueryList").find(".selectQueryLevel").select2({formatSelection:e});d.attr("readonly")&&d.select2("readonly",!0);$("#templateQueryList").find(".dateRangeEnumClass").select2({formatSelection:e}).on("change",function(b){daraRangeEnumClassOnChange(this)});
$("#templateQueryList").find(".expressionField").select2({formatSelection:e});$("#templateQueryList").find(".expressionOp").select2({formatSelection:e});$("#templateQueryList").find(".expressionValueSelect").select2({separator:";",formatSelection:e});$("#templateQueryList").find(".authorizationType").select2({formatSelection:e});$("#templateQueryList").find(".msgType").select2({formatSelection:e});$("#templateQueryList").find(".distributionChannelName").select2({formatSelection:e})}$("#templateQueryList").on("click",
".templateQueryDeleteButton",function(){g=$(this).attr("data-id");var b=$(this).parents(".templateQuery-div");b.find("input[id$=dynamicFormEntryDeleted]").attr("value","true");0<b.find(".relativeDateRangeValue").size()&&(b.find(".relativeDateRangeValue")[0].value=1);b.hide();1==$(".templateQuery-div:visible").length&&l($(".templateQuery-div:visible"));rearrangePOIInputsCount();showHideSpecialFields();updateAttachmentTable(g);updateTemplateQueryLineItem(g);delete list[g];list.includes(e2BDistributionChannel)?
$(".e2BConfiguration").show():$(".e2BConfiguration").hide()});1==$(".templateQuery-div:visible").length&&l($(".templateQuery-div:visible"));$(".addTemplateQueryLineItemButton").on("click",n);$(".copyTemplateQueryLineItemButton").on("click",t);$(".showHeaderFooterArea").on("click",R);$(".footerSelect").each(function(){$(this).autocomplete({source:$(this).data("select"),minLength:0})})})();$("#templateQueryList").on("click",".createTemplateQueryButton",function(){var d=$(this),b=d.attr("data-url"),
a=d.attr("data-message"),b=b+(-1<b.indexOf("?")?"&templateQueryIndex=":"?templateQueryIndex=");a:{for(var d=$(d).closest(".templateQuery-div"),c=0,e=$("#templateQueryList").find(".templateQuery-div"),f=0;f<e.length;f++){if($(e[f]).is(d)){d=c;break a}"false"==$(e[f]).find("input[id$=dynamicFormEntryDeleted]").val()&&c++}d=c}showWarningOrSubmit(b+d,a)});$("#saveDistributionEmailConfiguration").on("click",function(){var c=!0;$("div.alert").hide();$("#to").parent().removeClass("has-error");$("#subject").parent().removeClass("has-error");
var b=$("#body").val(tinyMCE.activeEditor.getContent());b.parent().removeClass("has-error");if(null==$("#to").val()||""==$("#subject").val().trim()||""==$("#body").val().trim())$("div.alert").show(),null==$("#to").val()?$("#to").parent().addClass("has-error"):$("#to").parent().removeClass("has-error"),""==$("#subject").val()?$("#subject").parent().addClass("has-error"):$("#subject").parent().removeClass("has-error"),""==$("#body").val()?b.parent().addClass("has-error"):b.parent().removeClass("has-error"),
c=!1;if(!c)return!1;c=$("#body").val(tinyMCE.activeEditor.getContent());$("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.subject").val($("#subject").val());$("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.to").val($("#to").val());$("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.cc").val($("#cc").val());$("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.body").val(c.val());$("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.deliveryReceipt").val($("#deliveryReceiptCheckbox").prop("checked"));
""!=$("#subject").val()||""!=$("#body").val()||null!=$("#to").val()||null!=$("#cc").val()||$("#deliveryReceipt").is(":checked")||tinyMCE.activeEditor&&""!==tinyMCE.activeEditor.getContent().trim()?$("#showEmailConfiguration-"+rowIndex+" img").attr({src:"/reports/assets/icons/email-secure.png",title:$.i18n._("app.configuration.addEmailConfigurationEdited.label")}):$("#showEmailConfiguration-"+rowIndex+" img").attr({src:"/reports/assets/icons/email.png",title:$.i18n._("app.configuration.addEmailConfiguration.label")});
$(this).attr("data-dismiss","modal");$("#to").select2("val","");$("#cc").select2("val","");$("#subject").val("");$("#body").val(tinyMCE.activeEditor.setContent(""));$("#deliveryReceiptCheckbox").removeProp("checked")});$("#resetDistributionEmailConfiguration").on("click",function(c){$("#to").select2("val","");$("#cc").select2("val","");$("#subject").val("");$("#body").val(tinyMCE.activeEditor.setContent(""));$("#deliveryReceiptCheckbox").removeProp("checked")});h.sortable({axis:"y",cursor:"move",
tolerance:"pointer",revert:"invalid",placeholder:"templateQuery-placeholder",forceHelperSize:!0,sort:function(c,b){var a=$(this),e=b.helper.outerHeight();a.children().each(function(){if($(this).hasClass("ui-sortable-helper")||$(this).hasClass("ui-sortable-placeholder")||$(this).hasClass("templateQuery-placeholder"))return!0;var c=Math.abs(b.position.top-$(this).position().top),d=b.position.top>$(this).position().top;if(e-c>e/2&&c<e)return d?$(".ui-sortable-placeholder",a).insertBefore($(this)):$(".ui-sortable-placeholder",
a).insertAfter($(this)),!1})}}).on("sortupdate",function(c,b){$("#templateQueryList").children('div[id^="templateQuery"]').each(function(a){$(this).find('[name*="templateQueries"], [id*="templateQueries"]').each(function(){"undefined"!==typeof $(this).attr("name")&&$(this).attr("name",$(this).attr("name").replace(/templateQueries\[\d+\]/,"templateQueries["+a+"]"));"undefined"!==typeof $(this).attr("id")&&$(this).attr("id",$(this).attr("id").replace(/templateQueries\[\d+\]/,"templateQueries["+a+"]"))});
$(this).find('[name^="templateQuery"]','[id^="templateQuery"]').each(function(){"undefined"!==typeof $(this).attr("name")&&$(this).attr("name",$(this).attr("name").replace(/templateQuery\d+/,"templateQuery"+a));"undefined"!==typeof $(this).attr("id")&&$(this).attr("id",$(this).attr("id").replace(/templateQuery\d+/,"templateQuery"+a))});$(this).attr("id",$(this).attr("id").toString().replace(/templateQuery\d+/,"templateQuery"+a))})})});
function distributionChannelChanged(c){list=[];for(var g=$("#templateQueryList").find(".templateQuery-div"),h=0;h<g.length;h++)"false"==$("#templateQueries\\["+h+"\\]\\.dynamicFormEntryDeleted").val()&&list.push($("#templateQueries\\["+h+"\\]\\.distributionChannelName").val());list.includes(e2BDistributionChannel)?$(".e2BConfiguration").show():$(".e2BConfiguration").hide();"EMAIL"==$("#templateQueries\\["+c+"\\]\\.distributionChannelName").val()?($("#showEmailConfiguration-"+c+" img").attr({src:"/reports/assets/icons/email.png",
title:$.i18n._("app.configuration.addEmailConfiguration.label")}),$("#showEmailConfiguration-"+c).show()):($("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.subject").val(""),$("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.to").val(""),$("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.cc").val(""),$("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.body").val(""),$("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.deliveryReceipt").val($("#deliveryReceiptCheckbox").removeProp("checked")),
$("#showEmailConfiguration-"+c).hide())}
function showEmailConfiguration(c){rowIndex=c;$("#subject").val($("#templateQueries\\["+c+"\\]\\.emailConfiguration\\.subject").val());$("#to").select2("val",$("#templateQueries\\["+c+"\\]\\.emailConfiguration\\.to").val());$("#cc").select2("val",$("#templateQueries\\["+c+"\\]\\.emailConfiguration\\.cc").val());$("#body").val(tinyMCE.activeEditor.setContent($("#templateQueries\\["+c+"\\]\\.emailConfiguration\\.body").val()));$("#deliveryReceiptCheckbox").prop($("#templateQueries\\["+c+"\\]\\.emailConfiguration\\.deliveryReceipt").prop("checked"));
$("#emailConfigurationDistributionChannel").modal("show")}
function viewEmailConfiguration(c){rowIndex=parseInt(c.replace("showEmailConfiguration-",""));$("#subject").val($("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.subject").val());$("#to").select2("val",$("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.to").val());$("#cc").select2("val",$("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.cc").val());$("#body").val(tinyMCE.activeEditor.setContent($("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.body").val()));
$("#deliveryReceiptCheckbox").prop($("#templateQueries\\["+rowIndex+"\\]\\.emailConfiguration\\.deliveryReceipt").prop("checked"));$("#emailConfigurationDistributionChannel").modal("show");$("#subject").attr("disabled","disabled");$("#to").attr("disabled","disabled");$("#cc").attr("disabled","disabled");tinymce.activeEditor.setMode("readonly");$("#deliveryReceiptCheckbox").attr("disabled","disabled")}function bindQuerySelect2(c){return bindSelect2WithUrl(c,querySearchUrl,queryNameUrl,!0)}
function bindTemplateSelect2(c){return bindSelect2WithUrl(c,templateSearchUrl,templateNameUrl,!1)}function updateAttachmentTable(c){"function"===typeof formAttachmentTable&&formAttachmentTable(c)}function updateTemplateQueryLineItem(c){$(".templateQueryDeleteButton").each(function(){var g=parseInt($(this).attr("data-id"));g>parseInt(c)&&$(this).attr("data-id",g-1)})};