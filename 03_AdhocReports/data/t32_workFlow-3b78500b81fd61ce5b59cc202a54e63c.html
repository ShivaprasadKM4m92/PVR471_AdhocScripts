//# sourceMappingURL=workFlow.js.map
var rptRequestId;function showOpenActionItemsModal(a,c,b,d,e){$("#warningModal .description").text(c);$("#warningModal").modal("show");$("#warningButton").unbind("click").click(function(){confirmClosureOfReportRequest(a,d,e,b)})}
var confirmClosureOfReportRequest=function(a,c,b,d){$.ajax({url:a,type:"post",data:c,success:function(a){$("#workflowErrorMessage").parent().addClass("hide");$("#workflowErrorMessage").html("");$("#warningModal").modal("hide");$("#workflowStatusJustification").modal("hide");reloadData(b,!0,d,a);successNotification(a.message)},error:function(a){a=JSON.parse(a.responseText);void 0!=a.message?($("#workflowErrorMessage").parent().removeClass("hide"),$("#workflowErrorMessage").html(a.message)):($("#workflowErrorMessage").parent().removeClass("hide"),
$("#workflowErrorMessage").html("Failed due to some reason!"))},beforeSend:function(){$("#saveButton").attr("disabled","disabled")},complete:function(){$("#saveButton").removeAttr("disabled")}})},confirmJustification=function(a,c){$("#workflowRuleId").val($("#workflowSelect > option:selected").attr("ruleId"));var b=$("#justificationForm").serialize(),b=b+("&password="+$("#password-input").val()),d=$("#reportId").val(),e=workflowJustificationConfirnUrl;c&&(e=c);var k="";"undefined"!==typeof isReportRequest&&
finalStates.includes($("#workflowSelect option:selected").text())?$.ajax({url:actionItemStatusForReportRequestUrl,data:{id:rptRequestId},success:function(c){"true"==c.actionItemStatus?(k=$.i18n._("reportRequest.actionItem.warning.label"),showOpenActionItemsModal(e,k,a,b,d)):confirmClosureOfReportRequest(e,b,d,a)}}):confirmClosureOfReportRequest(e,b,d,a)},reloadData=function(a,c,b,d){1!=c&&(c=!1);$("#"+b).DataTable().ajax.reload(function(){highlightRow(a);doAction(a,b,d.action)},c)},highlightRow=function(a,
c){void 0!=a&&""!=a&&$("#"+c).DataTable().row("#"+a).nodes().to$().addClass("flash-row")},doAction=function(a,c,b){b&&$("#"+c).DataTable().row("#"+a).nodes().to$().find("."+b).click()};function closeJustificationModal(){$("#workflowErrorMessage").parent().addClass("hide");$("#workflowErrorMessage").html("");$("div[id^='workflowStatusJustification']").modal("hide");$("#workflowSelect").html("")}
function openStateHistoryModal(a,c){$(a).attr("disabled","disabled");var b=$(a),d=b.attr("data-executed-config-id"),e=b.attr("data-reportRequest-id");"undefined"!==typeof isReportRequest&&(rptRequestId=e);var b=b.attr("data-initial-state"),k=$("#workflowStatusJustification");$("#workflowJustificationTable").find("tr:has(td)").remove();var g=workflowJustificationUrl;c&&(g=c);$.ajax({type:"GET",url:g,data:{initialState:b,executedReportConfiguration:d,reportRequestId:e},success:function(a){var b=$("#workflowSelect"),
c=$("#description"),f=a.actionItems;f&&"null"!==f&&"0"!==f?($("#workflow-warning").html($.i18n._("workFlow.actionItem.warning")),$("#workflow-warning").parent().show()):$("#workflow-warning").parent().hide();b.empty();c.val("");var c=a.currentState.id,f=a.workflowJustificationList,m=a.stateList.rules;a=a.stateList.needApproval;if($.isEmptyObject(m))b.attr("disabled","disabled"),b.append("<option disabled selected>No next state</option>"),$(".description-wrapper").hide(),$("#saveButton").hide();else{for(var l in m){var g=
m[l],h=$("<option></option>");h.attr("ruleId",l);h.attr("value",g.id);a&&a[l]&&h.attr("needApproval",a[l]);h.html(g.name);b.append(h)}b.find("option").first().attr("selected","selected");b.removeAttr("disabled");$(".description-wrapper").show();$("#saveButton").show()}$(b).on("change",function(){"true"===$("#workflowSelect > option:selected").attr("needApproval")?($("#needApprovalDiv").show(),$("#needApprovalDiv .password-input").val("")):$("#needApprovalDiv").hide()});b.trigger("change");k.modal("show");
$("#reportId").val(d);$("#wfReportRequestId").val(e);$("#fromState").val(c);$.isEmptyObject(f)?$("#workflowJustificationTable").append('<tr><td colspan="5" style="text-align: center">No state changes have been made.</td></tr>'):$.map(f,function(a,b){a.justification=encodeToHTML(a.justification);a="<tr id=tr"+i+'><td style="text-align: center">'+a.fromState+'</td><td style="text-align: center">'+a.toState+'</td><td style="text-align: center">'+a.dateCreated+'</td><td style="text-align: center">'+a.routedBy+
'</td><td style="text-align: center;word-break: break-word">'+a.justification+"</td></tr>";$("#workflowJustificationTable").append(a)})},error:function(a){JSON.parse(a.responseText)},complete:function(b){$(a).removeAttr("disabled")}})}
$(document).ready(function(){$(document).on("keyup paste cut",".password-input",function(){var a=$(this);""===a.val()?(a.attr("type","text"),$("#password-input-div").html('<input name="'+(new Date).getTime()+'" id="password-input" class="form-control password-input" type="text">'),$(".password-input").focus()):a.attr("type","password")})});