//# sourceMappingURL=pvr-filter-util.js.map
var pvr=pvr||{};
pvr.filter_util=function(){var m=400,u=function(a,e){var f={},b={};_.each(a,function(a){var c=e[0].key;a.filter_group&&(c=a.filter_group);if(_.isUndefined(a.group))f[c]||(f[c]=[]),f[c].push(a);else{b[c]||(b[c]={});if(_.isNull(b[c][a.group])||_.isUndefined(b[c][a.group]))b[c][a.group]=[];b[c]||(b[c]={});b[c][a.group].push(a)}});return[f,b]},q=function(a){$(a).toggle("slide",{direction:"right",duration:300})},r=function(a){var e=v(a);q(a);return _.isEmpty(e)?"":e},v=function(a){var e=function(a,b,e,
c,d){var h={};switch(a){case "range":h={type:"range",name:b};h["value"+c]=e;break;case "number-range":h={type:"number-range",name:b};h["value"+c]=6E4*e;break;case "value":case "boolean":h={type:"value",name:b,value:e};break;case "enum":h={type:"enum",name:b,value:e,dataType:d};break;case "text":case "id":case "multi-value-id":case "date":case "manual":h={type:a,name:b,value:e}}return h};return _.reduce($(a+" .filter-input"),function(a,b){var g=$(b).data("type"),c=$(b).data("name");if(!(_.isNull(g)||
_.isUndefined(g)||_.isNull(c)||_.isUndefined(c)))switch(g){case "date-range":var g=$(b).data("order"),d=$(b).val();_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(b=e("range",c,d,g),_.isNull(a[c])||_.isUndefined(a[c])?a[c]=b:a[c]=_.extend(a[c],b));break;case "number-range":g=$(b).data("order");d=$(b).val();_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(b=e("number-range",c,d,g),_.isNull(a[c])||_.isUndefined(a[c])?a[c]=b:a[c]=_.extend(a[c],b));break;case "select2-multi-id":d=$(b).select2("val");_.isNull(d)||
_.isUndefined(d)||_.isEmpty(d)||(b=e("multi-value-id",c,d),a[c]=b);break;case "date":case "text":d=$(b).val();_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(b=e(g,c,d),a[c]=b);break;case "select2-manual":d=$(b).val();_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(b=e("manual",c,d),a[c]=b);break;case "boolean":d=$(b).select2("val");b=e("boolean",c,d);_.isNull(d)||_.isEmpty(d)||(a[c]=b);break;case "select2-id":d=$(b).val();_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(b=e("id",c,d),a[c]=b);break;case "id":d=
$(b).val();_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(b=e("id",c,d),a[c]=b);break;case "select2-enum":d=$(b).val();b=$(b).data("data-type");_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(b=e("enum",c,d,-1,b),a[c]=b);break;default:d=$(b).val(),_.isNull(d)||_.isUndefined(d)||_.isEmpty(d)||(b=e("value",c,d),a[c]=b)}return a},{})},w=function(){var a=_.find($(".filter-input"),function(a){a=$(a).val();return!(_.isEmpty(a)||_.isNull(a))});return!(_.isNull(a)||_.isUndefined(a))},n=function(a){var e=$(window).width();
$(window).height();var f=$(".lib-filter").offset(),f=0>f.top?25:f.top+25,b=$(window).scrollTop();125<b&&(f=b);$(a).css("top",f+"px").css("width",m+"px").css("position","absolute").css("margin-left",e-m-10+"px")},p=function(a){a?$(".lib-filter").css("color","black"):$(".lib-filter").css("color","#999")},x=function(a,e){if(null===a)return"";for(var f=Math.ceil(a.length/e),b=Math.floor(12/e),g="",c=0;c<f;c++){for(var d="<div class='row'>",h=0,k;h<e;h++)k=c*e+h,d=k<a.length?d+('<div class="col-sm-'+b+
'"><label class="col-sm-5" style="text-align: right;"><b>'+a[k].label+':</b></label><div class="col-sm-7" style="vertical-align: bottom">'+l(a[k])+"</div></div>\n"):d+('<div class="col-sm-'+b+'"></div>');d+="</div>";g+=d+"\n"}return g},y=function(a,e){if(a){var f="",b=Math.floor(12/e);_.each(_.pairs(a),function(a){var c="";a=_.sortBy(a[1],function(a){return a.group_order});c+="<div class='row'>";"number-range"==a[0].type?c+='<div class="col-sm-'+b+'"><label class="col-sm-5" style="text-align: right;"><b>'+
a[0].label+':</b></label><div class="col-sm-3">'+l(a[0])+'</div><label class="col-sm-1" style="text-align: right;">'+a[1].label+'</label><div class="col-sm-3">'+l(a[1])+"</div></div>\n":_.each(a,function(a){c+='<div class="col-sm-'+b+'"><label class="col-sm-5" style="text-align: right;"><b>'+a.label+':</b></label><div class="col-sm-7">'+l(a)+"</div></div>\n"});c+="</div>";f+=c});return f}return""},l=function(a){var e=function(a){var e="";$.ajax({url:a.ajax.url,async:!1,success:function(c){e=a.ajax.data_handler(c)},
error:function(c){a.ajax.error_handler(c)}});return e},f="";switch(a.type){case "boolean":f="data-name='"+a.name+"' data-type='"+a.type+"'";f="<select style='width: 100%;' id='testselect' class='filter-input form-control filter-select2' "+f+">\n<option value=''></option>\n<option value='true'>True</option>\n";f+="<option value='false'>False</option>\n";f+="</select>";break;case "date-range":f="data-name='"+a.group+"' data-type='date-range' data-order='"+a.group_order+"'";f="<div>"+pvr.common_util.render_tmpl("datepicker",
{id:"tmp-id",title:"Title",cls:"filter-date-picker",extra_attrs:f})+"</div>";break;case "date":f="data-name='"+a.name+"' data-type='"+a.type+"'";f="<div>"+pvr.common_util.render_tmpl("datepicker",{id:"tmp-id",title:"Title",cls:"filter-date-picker",extra_attrs:f})+"</div>";break;case "select":f="<select style='width: 100%;' data-name='"+a.name+"' data-type='"+a.type+"'>";a.ajax&&(f+=e(a));f+="</select>";break;case "select2":case "select2-id":f="<select style='width: 100%;' class='filter-input form-control filter-select2' data-name='"+
a.name+"' data-type='"+a.type+"'>";a.ajax&&(f+=e(a));f+="</select>";break;case "select2-manual":case "select2-enum":f="<select style='width: 100%;' data-name='"+a.name+"' class='filter-input form-control filter-select2' data-type='"+a.type+"' data-data-type='"+a.data_type+"'>";f+=t(a.data,"key","value",!0);f+="</select>";break;case "select2-multi-id":f="<select style='width: 100%;' data-name='"+a.name+"' class='filter-input form-control filter-select2' multiple='multiple' data-type='"+a.type+"'>";
a.ajax&&(a=e(a),f+=a);f+="</select>";break;case "number-range":f="<input class='filter-input form-control' style='width:100%' data-type='"+a.type+"' type='number' data-name='"+a.group+"' data-order= '"+a.group_order+"' onkeypress='return (event.keyCode >47 && event.keyCode <58)' min='0'>";break;case "number":f="<input class='filter-input form-control' style='width:100%' data-type='"+a.type+"' type='number' data-type='"+a.type+"'  data-name='"+a.name+"' onkeypress='return (event.keyCode >47 && event.keyCode <58)' min='0'>";
break;default:f="<input class='filter-input form-control' style='width: 100%' data-type='"+a.type+"'  data-name='"+a.name+"'>"}return f},t=function(a,e,f,b){var g=b?"<option value=''></option>\n":"";_.each(a,function(a){g+="<option value='"+a[e]+"'>"+a[f]+"</option>\n"});return g};return{construct_right_filter_panel:function(a){var e=a.container_id,f=a.filter_defs,b=a.column_count,g=a.done_func;a.panel_width&&(m=a.panel_width);a=a.filter_group?a.filter_group:[{key:"default"}];for(var f=u(f,a),c="",
d=0;d<a.length;d++){var h=a[d].key,k="";f[0][h]&&(k=x(f[0][h],b));f[1][h]&&(k+=y(f[1][h],b));0<d&&""!=$.trim(k)&&(c+=" <hr> ");c+=k}b=pvr.common_util.render_tmpl("filter_panel",{id:e,filter_body:c});b=$.parseHTML(b);$("body").append(b);$(".filter-select2").select2({allowClear:!0});$(".filter-date-picker").datepicker({allowPastDates:!0,date:null,momentConfig:{culture:userLocale,format:DEFAULT_DATE_DISPLAY_FORMAT}});$(".datepicker input.form-control").addClass("filter-input");$("#"+e).find(".apply-button").click(function(a){a.preventDefault();
a=r("#"+e);g(a);w()?p(!0):p(!1);return!1});$("#"+e).find(".clear-button").click(function(a){a.preventDefault();a="#"+e;$(a).find(".filter-input").val("");$(a).find("input.filter-input[type='checkbox']").removeAttr("checked");$(".filter-select2").select2("val","");p(!1);return!1});$("#"+e).find("input.filter-input").keypress(function(a){if(13==a.which)return a.preventDefault(),g(r("#"+e)),!1});n("#"+e);$("#"+e).hide();(function(){$(".lib-filter").click(function(){$(e).is(":visible")?q("#"+e):$("#"+
e).toggle("slide",{direction:"right",duration:300})})})();$("#mainContent,.topbar,#sidebar-menu").click(function(){$("#"+e).hide()});$(window).on("resize",function(a){n("#"+e)});$(window).on("scroll",function(a){n("#"+e)})},build_options:t}}();